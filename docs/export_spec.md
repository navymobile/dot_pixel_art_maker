# 画像エクスポート機能仕様書

## 1. 概要

本機能は、作成したドット絵を外部WebサービスやSNS、LINEスタンプ等で使用可能な**透過PNG形式**で書き出すための機能である。
特に「ドット絵の純度（クッキリ感）」を最優先とし、**Nearest Neighbor（最近傍補間）** による拡大のみを行う。
エクスポートには以下の2つのモードを用意する。

1.  **汎用エクスポートモード**：通常のSNS投稿やWeb素材用（正方形、余白なし）。
2.  **LINEスタンプ専用モード**：LINEスタンプ登録用（370×320px、余白あり）。

---

## 2. 共通仕様

- **ファイル形式**: PNG
- **カラーモード**: RGBA（透過維持）
  - 背景色の未描画部分は完全に透過（alpha=0）とする。
- **拡大アルゴリズム**: **Nearest Neighbor（最近傍補間）**
  - アンチエイリアス（ぼかし）処理は**禁止**。
  - 補間処理（Bilinear/Bicubicなど）は**禁止**。
- **拡大ルール**:
  - 原則として**整数倍**の拡大のみを行う。
  - 端数が出るようなリサイズやトリミングは行わない。

---

## 3. モードA: 汎用エクスポート (General Export)

Webアイコン、SNSプロフィール、投稿画像など、一般的な用途向けのモード。
キャンバス全体を対象に、正方形のまま拡大して出力する。

### 3.1. 出力仕様

- **キャンバスサイズ**: [原寸] × [整数倍率] の正方形
- **余白**: なし（トリミングなし）
- **配置**: 全体描画

### 3.2. 出力サイズ区分

ユーザーは以下のプリセットからサイズを選択する。
各区分は「最低ピクセル数」を満たす**最小の整数倍**を採用する。

| 区分               | 最低要件 (px) | 出力サイズ例 (21px作品) | 倍率 | 用途例                  |
| :----------------- | :------------ | :---------------------- | :--- | :---------------------- |
| **小 (Small)**     | 320px以上     | **336 × 336**           | ×16  | Webアイコン、サムネイル |
| **中 (Medium)**    | 640px以上     | **651 × 651**           | ×31  | SNS投稿、プロフィール   |
| **大 (Large M)**   | 1024px以上    | **1029 × 1029**         | ×49  | 高解像度SNS、Web掲載    |
| **特大 (Large L)** | 1280px以上    | **1281 × 1281**         | ×61  | 印刷用、保存用素材      |

※ 42px作品やその他サイズの場合も、上記「最低要件」を超える最小の整数倍を自動計算して適用する。

---

## 4. モードB: LINEスタンプ専用 (LINE Sticker Export)

LINEクリエイターズマーケットのスタンプ画像規定に準拠した画像を生成するモード。
規定サイズ（W370×H320）に合わせて配置し、適切な余白を確保する。

### 4.1. 出力仕様

- **キャンバスサイズ**: 横 **370px** × 縦 **320px** (固定)
- **背景**: 透過
- **余白**: 上下左右に約10px以上の安全余白を確保（※配置ロジック参照）。

### 4.2. 拡大・配置ロジック

ドット絵を崩さないため、ここでも**整数倍**の拡大を厳守する。
また、LINEスタンプの審査基準（余白）とピクセルグリッドの整合性を最優先する。

#### 21×21 px 作品の場合

- **倍率**: **14倍** (変更)
- **描画サイズ**: 21px × 14 = **294px** (正方形)
- **配置**: キャンバス中央（Center）
- **余白**:
  - 横: (370 - 294) / 2 = **38px** (左右均等)
  - 縦: (320 - 294) / 2 = **13px** (上下均等)
  - **理由**: 15倍(315px)では縦余白が5pxとなり、上下に整数で配分できない(2.5px)ため廃止。14倍を採用することで、推奨余白(10px)を確保しつつ整数座標での配置を実現する。

#### 42×42 px 作品 (Scale=2) の場合

- **倍率**: **7倍**
- **描画サイズ**: 42px × 7 = **294px** (正方形)
- **配置**: キャンバス中央（Center）
- **余白**:
  - 横: 38px
  - 縦: 13px
  - ※21px作品と全く同じサイズ・余白構成となる。

---

## 5. UI/UX 要件

### 5.1. エクスポート画面構成

1.  **プレビューエリア**
    - 生成される画像を中央に表示。
    - 背景は透過が確認できるよう、市松模様（チェック柄）などを敷く。
2.  **モード切り替え**
    - **[汎用]** タブ / **[LINEスタンプ]** タブ で切り替え。
3.  **サイズ選択 (汎用モード時のみ)**
    - ラジオボタン等で [原寸 / x2 / x3 / Small / Medium / Large...] を選択可能にする。
    - 各選択肢には「実際の出力サイズ（例: 336x336）」を併記する。
4.  **アクションボタン**
    - **「保存 / 共有」**: OS標準の共有シート (`Share.shareXFiles`) を呼び出す。

## 6. ファイル命名規則

- **汎用**: `dot_{dot_id}_{size_label}.png` (例: `dot_123_M.png`)
- **LINE**: `dot_{dot_id}_line.png`
